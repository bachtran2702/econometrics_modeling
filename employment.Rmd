---
title: "employment"
author: "Bach Tran"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(forecast)
library(PerformanceAnalytics)
library(stats)
library(tidyr)
library(tseries) 
library(TTR)
library(zoo)
library(lubridate)
library(car) 
library(ggplot2)
library(quantmod)
library(tsibble)
library(xts)
library(tibble)
library(fpp3)
library(extrafont)

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r macro data, echo = T}
#wrestle the data from chr type "%m/%d/%y" data to zoo type year month 
dta = read.csv("employment_dta.csv", col.names = c("month", "retail_trade_employment", "all_employment")) %>%
  mutate(month = yearmonth(as.Date(month, format = "%m/%d/%y"))) %>%
  mutate(retail_trade_employment = as.numeric(retail_trade_employment),
         all_employment = as.numeric(all_employment))%>%
  as_tsibble()

retail_trade_employment_ts = ts(dta$retail_trade_employment, frequency = 12, start =c(2000,1))
all_employment_ts = ts(dta$all_employment, frequency = 12, start = c(2000,1))
```

```{r trend vis, echo =T}
ggAcf(retail_trade_employment_ts)
ggseasonplot(retail_trade_employment_ts) 
 
dta %>% 
  gg_subseries(retail_trade_employment) +
  labs(
    y = "Thousands of Persons",
    title = " All Employees: Retail Trade in the United States"
  )

ggAcf(all_employment_ts)
ggseasonplot(all_employment_ts) 
dta %>%
  gg_subseries(all_employment) +
    labs(
    y = "Thousands of Persons",
    title = " All non-farm employees in California"
  ) 
```

```{r retail trade forecast data, echo =T}
retail_trade_employment_ts_window = window(retail_trade_employment_ts, start = c(2010,1))

#model 2
fit_1_rt = forecast::hw(retail_trade_employment_ts_window, seasonal = "multiplicative", damped =T, h = 36)
fit_2_rt = forecast::hw(retail_trade_employment_ts_window , seasonal = "additive", damped = T, h = 36)
fit_3_rt = auto.arima(retail_trade_employment_ts_window )%>%
  forecast(h = 12)

autoplot(fit_1_rt)
autoplot(fit_2_rt)
autoplot (fit_3_rt)

checkresiduals(fit_1_rt)
checkresiduals(fit_2_rt)
checkresiduals(fit_3_rt)
```

```{r retail trade final model}
final_model = fit_3_rt
final_model_vis = autoplot(final_model) + aes(color = "#ED3833", labels = "Historical Data") +
  ylim(200,800) +
  #scales
  scale_y_continuous(n.breaks = 10) +
  scale_x_yearmon(n = 10) +
  labs(x= "", 
       y = "Employees (1000)", 
       subtitle = "Employment for retail trade is expected to peak at around 16.1 million employees each year.\nPositive trend and less volatile seasonality as time progress",
       caption = "Forecasted using ARIMA(0,1,2)(2,1,0)[12] model. Data Retreived from FRED (CEU4200000001) on Nov 01, 2024") +
    #positions of title
  theme(text=element_text(family="Calibri"),
        plot.title = element_blank(),
    #plot caption
        plot.caption.position =  "plot",
        plot.caption = element_text(hjust = 0)) +
  theme(panel.grid.major.y = element_line(color = "#DDD9C3"),
        panel.background = element_blank())  +
    
    #remove background and tick marks and legend
  theme(axis.ticks.y = element_blank(),
        axis.line = element_line(color = "black", size = 0.75, linetype = "solid"),
        legend.position = "none") +
    #start period
  annotate(geom = "point", x = 2024.917, y = 16098.07, colour = "red", size = 0.78)  

ggsave('retail_trade_employement_us.png', width = 9.75, height = 4.75, units = "in")
 #width = 39, height = 19, units = "in"
```
```{r rall employee data, echo =T}
fit_0_ae = forecast::hw(all_employment_ts, seasonal = "additive", damped = T, h = 14)

#subset for a smaller window due to previous model doesnt yield best result
all_employment_ts_window = window(all_employment_ts, start = c(2010,1))


#model 2
fit_1_ae = forecast::hw(all_employment_ts_window, seasonal = "multiplicative", damped =T, h = 14)
fit_2_ae = forecast::hw(all_employment_ts_window, seasonal = "additive", damped = T, h = 14)
fit_3_ae = auto.arima(all_employment_ts_window)%>%
  forecast(h = 14)
fit_4_ae = forecast::ets(all_employment_ts_window)%>%
  forecast(h = 12)

autoplot(fit_1_ae)
autoplot(fit_2_ae)
autoplot (fit_3_ae)
autoplot (fit_4_ae)

checkresiduals(fit_1_ae)
checkresiduals(fit_2_ae)
checkresiduals(fit_3_ae)
checkresiduals(fit_4_ae)
```
```{r retail all final model}
final_model_all = fit_4_ae
final_model_vis = autoplot(final_model_all) + aes(color = "#ED3833", labels = "Historical Data") +
  annotate(geom = "point", x = 2024.833, y = 158293.2, colour = "red", size = 0.78)  +
  annotate(geom = "point", x = 2025.750, y = 162291.2, colour = "red", size = 0.78) +
  #scales
  scale_x_yearmon(n = 10) +
  labs(x= "", 
       y = "Employees (1000)", 
       subtitle = "US employment market growth recovered and is projected to continue its expansion.\nEmployment is forecasted to grow by 2% by 2025 Q4",
       caption = "Forecasted using ETS method with Multiplicative error, Additive trend and season. Data Retreived from FRED (PAYNSA) on Nov 01, 2024") +
    #positions of title
  theme(text=element_text(family="Calibri"),
        plot.title = element_blank(),
    #plot caption
        plot.caption.position =  "plot",
        plot.caption = element_text(hjust = 0)) +
  theme(panel.grid.major.y = element_line(color = "#DDD9C3"),
        panel.background = element_blank())  +
    
    #remove background and tick marks and legend
  theme(axis.ticks.y = element_blank(),
        axis.line = element_line(color = "black", size = 0.75, linetype = "solid"),
        legend.position = "none")
ggsave('all_employement_us.png', width = 9.75, height = 4.75, units = "in")
 #width = 39, height = 19, units = "in"
```
## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
